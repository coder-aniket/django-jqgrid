{% extends 'example/base.html' %}
{% load static %}

{% block title %}{{ title }} - Django jqGrid Examples{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h1 class="h2">
                <i class="fas fa-users text-primary"></i>
                {{ title }}
            </h1>
            <p class="text-muted">{{ description }}</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'example:index' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i>
                Back to Examples
            </a>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Customer Database</h5>
                </div>
                <div class="card-body">
                    <table id="{{ grid_id }}"></table>
                    <div id="{{ grid_id }}Pager"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#{{ grid_id }}').jqGrid({
        url: '{{ api_url }}',
        datatype: 'json',
        mtype: 'GET',
        colNames: ['ID', 'Name', 'Email', 'Phone', 'City', 'State', 'Type', 'Active', 'Orders', 'Registered'],
        colModel: [
            {name: 'id', index: 'id', width: 60, sortable: true, hidden: true, key: true},
            {name: 'full_name', index: 'last_name', width: 150, sortable: true},
            {name: 'email', index: 'email', width: 200, sortable: true},
            {name: 'phone', index: 'phone', width: 120, sortable: false},
            {name: 'city', index: 'city', width: 100, sortable: true},
            {name: 'state', index: 'state', width: 80, sortable: true},
            {name: 'customer_type_display', index: 'customer_type', width: 100, sortable: true, align: 'center'},
            {
                name: 'is_active', 
                index: 'is_active', 
                width: 80, 
                sortable: true, 
                align: 'center',
                formatter: function(cellvalue, options, rowObject) {
                    return cellvalue ? 
                        '<span class="badge bg-success">Active</span>' : 
                        '<span class="badge bg-secondary">Inactive</span>';
                }
            },
            {name: 'order_count', index: 'order_count', width: 80, sortable: false, align: 'center'},
            {name: 'registration_date', index: 'registration_date', width: 120, sortable: true, formatter: 'date'}
        ],
        pager: '#{{ grid_id }}Pager',
        rowNum: 25,
        rowList: [10, 25, 50],
        sortname: 'last_name',
        sortorder: 'asc',
        viewrecords: true,
        caption: 'Customer Management',
        autowidth: true,
        height: 450,
        multiselect: true,
        gridComplete: function() {
            $('#{{ grid_id }}').jqGrid('filterToolbar', {
                searchOnEnter: false,
                enableClear: true
            });
        }
    });
    
    $('#{{ grid_id }}').jqGrid('navGrid', '#{{ grid_id }}Pager', {
        edit: false,
        add: false,
        del: false,
        search: true,
        refresh: true
    });
});
</script>
{% endblock %}